/* empty css                *//* empty css               *//* empty css               *//* empty css               */import{r as f}from"./request-9dc1f99e.js";import{c as E,e as n,i as b,h as w,g as s,w as r,l as d,E as g,K as V,J as z,S as D,M as U,N as u,f as i,T as B,U as I,V as M,P}from"./index-c150de53.js";const T={class:"card",style:{"margin-bottom":"5px"}},$={class:"card",style:{"margin-bottom":"5px"}},O={key:0,class:"card"},G={__name:"Orders",setup(R){const e=E({user:JSON.parse(localStorage.getItem("system-user")||"{}"),pageNum:1,pageSize:10,total:0,formVisible:!1,form:{},tableData:[],order_no:null});console.log(e.user),console.log(e.user.role==="USER");const m=()=>{e.user.role==="USER"?f.get("/orders/selectPage",{params:{pageNum:e.pageNum,pageSize:e.pageSize,order_no:e.order_no,user_id:e.user.id}}).then(l=>{var a,o;e.tableData=(a=l.data)==null?void 0:a.list,e.total=(o=l.data)==null?void 0:o.total}):e.user.role==="ADMIN"?f.get("/orders/selectPage",{params:{pageNum:e.pageNum,pageSize:e.pageSize,order_no:e.order_no}}).then(l=>{var a,o;e.tableData=(a=l.data)==null?void 0:a.list,e.total=(o=l.data)==null?void 0:o.total}):g.info("请先登录")},y=(l,a)=>{l.status=a,console.log(l),console.log(e.form),f.put("/orders/update",l).then(o=>{o.code==="200"?(m(),g.success("操作成功"),e.formVisible=!1):g.error(o.msg)})},h=l=>{B.confirm("删除后数据无法恢复，您确定删除吗?","删除确认",{type:"warning"}).then(a=>{f.delete("/orders/delete/"+l).then(o=>{o.code==="200"?(m(),g.success("操作成功")):g.error(o.msg)})}).catch(a=>{})},C=(l,a)=>{f.get("/goods/cancelOrder",{params:{goods_id:l,num:a}}).then(o=>{o.code==="200"?(m(),g.success("操作成功"),e.formVisible=!1):(console.log(o),g.error(o.msg))})},N=()=>{e.order_no=null,m()};return m(),(l,a)=>{const o=V,p=z,c=I,S=M,_=P,v=D,x=U;return n(),b("div",null,[w("div",T,[s(o,{modelValue:e.order_no,"onUpdate:modelValue":a[0]||(a[0]=t=>e.order_no=t),style:{width:"300px","margin-right":"10px"},placeholder:"请输入订单编号查询"},null,8,["modelValue"]),s(p,{type:"primary",onClick:m},{default:r(()=>[u("查询")]),_:1}),s(p,{type:"info",style:{margin:"0 10px"},onClick:N},{default:r(()=>[u("重置")]),_:1})]),w("div",$,[s(v,{data:e.tableData,stripe:""},{default:r(()=>[s(c,{label:"订单编号",prop:"order_no"}),s(c,{label:"商品名称",prop:"goods_name"}),s(c,{label:"商品图片",prop:"goods_img"},{default:r(t=>[s(S,{style:{"border-radius":"5%","max-width":"50px"},src:t.row.goods_img,"preview-src-list":[t.row.goods_img],"preview-teleported":!0},null,8,["src","preview-src-list"])]),_:1}),s(c,{label:"购买数量",prop:"num"}),s(c,{label:"下单人",prop:"user_name"}),s(c,{label:"订单状态",prop:"status"},{default:r(t=>[t.row.status==="待支付"?(n(),i(_,{key:0,type:"warning"},{default:r(()=>[u("待支付")]),_:1})):d("",!0),t.row.status==="待发货"?(n(),i(_,{key:1,type:"success"},{default:r(()=>[u("待发货")]),_:1})):d("",!0),t.row.status==="待收货"?(n(),i(_,{key:2,type:"info"},{default:r(()=>[u("待收货")]),_:1})):d("",!0),t.row.status==="已收货"?(n(),i(_,{key:3,type:"success"},{default:r(()=>[u("已收货")]),_:1})):d("",!0),t.row.status==="已取消"?(n(),i(_,{key:4,type:"danger"},{default:r(()=>[u("已取消")]),_:1})):d("",!0)]),_:1}),s(c,{label:"下单时间",prop:"time"}),s(c,{label:"操作","header-align":"center",width:"160"},{default:r(t=>[t.row.status==="待支付"?(n(),i(p,{key:0,type:"danger",onClick:k=>(y(t.row,"已取消"),C(t.row.goods_id,t.row.num))},{default:r(()=>[u("取消")]),_:2},1032,["onClick"])):d("",!0),e.user.role==="USER"&&t.row.status==="待支付"?(n(),i(p,{key:1,type:"danger",onClick:k=>y(t.row,"待发货")},{default:r(()=>[u("支付")]),_:2},1032,["onClick"])):d("",!0),e.user.role==="ADMIN"&&t.row.status==="待发货"?(n(),i(p,{key:2,type:"danger",onClick:k=>y(t.row,"待收货")},{default:r(()=>[u("发货")]),_:2},1032,["onClick"])):d("",!0),e.user.role==="USER"&&t.row.status==="待收货"?(n(),i(p,{key:3,type:"danger",onClick:k=>y(t.row,"已收货")},{default:r(()=>[u("收货")]),_:2},1032,["onClick"])):d("",!0),e.user.role==="ADMIN"?(n(),i(p,{key:4,type:"danger",onClick:k=>h(t.row.id)},{default:r(()=>[u("删除")]),_:2},1032,["onClick"])):d("",!0)]),_:1})]),_:1},8,["data"])]),e.total?(n(),b("div",O,[s(x,{background:"",layout:"prev, pager, next","page-size":e.pageSize,"onUpdate:pageSize":a[1]||(a[1]=t=>e.pageSize=t),"current-page":e.pageNum,"onUpdate:currentPage":a[2]||(a[2]=t=>e.pageNum=t),total:e.total},null,8,["page-size","current-page","total"])])):d("",!0)])}}};export{G as default};
